<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Modbus Validator | FluentModbus </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Modbus Validator | FluentModbus ">
      
      <link rel="icon" href="../images/icon.png">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/Apollo3zehn/FluentModbus/blob/dev/doc/samples/modbus_validator.md/#L1">
  </head>

  <script type="module">
    import options from './../public/main.js'
    import { init } from './../public/docfx.min.js'
    init(options)
  </script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="modbus-validator">Modbus Validator</h1>

<p>The following code is an extension to the <a href="modbus_tcp.html">Modbus TCP sample</a> but is just as valid for the RTU server. The <code>RequestValidator</code> property accepts a method which performs the validation each time a client sends a request to the server. This function will not replace the default checks but complement it. This means for example that the server will still check if the absolute registers limits are exceeded or an unknown function code is provided.</p>
<pre><code class="lang-cs">var server = new ModbusTcpServer()
{
    RequestValidator = this.ModbusValidator;
};

private ModbusExceptionCode ModbusValidator(
    byte unitIdentifier,
    ModbusFunctionCode functionCode, 
    ushort address, 
    ushort quantityOfRegisters)
{
    // check if address is within valid holding register limits
    var holdingLimits = (address &gt;= 50 &amp;&amp; address &lt; 90) ||
                         address &gt;= 2000 &amp;&amp; address &lt; 2100;

    // check if address is within valid input register limits
    var inputLimits = address &gt;= 1000 &amp;&amp; address &lt; 2000;

    // go through all cases and return proper response
    return (functionCode, holdingLimits, inputLimits) switch
    {
        // holding registers
        (ModbusFunctionCode.ReadHoldingRegisters, true, _)          =&gt; ModbusExceptionCode.OK,
        (ModbusFunctionCode.ReadWriteMultipleRegisters, true, _)    =&gt; ModbusExceptionCode.OK,
        (ModbusFunctionCode.WriteMultipleRegisters, true, _)        =&gt; ModbusExceptionCode.OK,
        (ModbusFunctionCode.WriteSingleRegister, true, _)           =&gt; ModbusExceptionCode.OK,

        (ModbusFunctionCode.ReadHoldingRegisters, false, _)         =&gt; ModbusExceptionCode.IllegalDataAddress,
        (ModbusFunctionCode.ReadWriteMultipleRegisters, false, _)   =&gt; ModbusExceptionCode.IllegalDataAddress,
        (ModbusFunctionCode.WriteMultipleRegisters, false, _)       =&gt; ModbusExceptionCode.IllegalDataAddress,
        (ModbusFunctionCode.WriteSingleRegister, false, _)          =&gt; ModbusExceptionCode.IllegalDataAddress,

        // input registers
        (ModbusFunctionCode.ReadInputRegisters, _, true)            =&gt; ModbusExceptionCode.OK,
        (ModbusFunctionCode.ReadInputRegisters, _, false)           =&gt; ModbusExceptionCode.IllegalDataAddress,

        // deny other function codes
        _                                                           =&gt; ModbusExceptionCode.IllegalFunction
    };
}
</code></pre>
</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Apollo3zehn/FluentModbus/blob/dev/doc/samples/modbus_validator.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          Copyright © 2024 Vincent Wilms
        </div>
      </div>
    </footer>
  </body>
</html>